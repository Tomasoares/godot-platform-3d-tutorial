[gd_scene load_steps=9 format=3 uid="uid://s0o1es323d32"]

[ext_resource type="ArrayMesh" uid="uid://cecgrwx86rx1w" path="res://Assets/Models/coin.res" id="1_d5gmh"]
[ext_resource type="Script" uid="uid://dmgvblmgryl87" path="res://Assets/Nodes/Collectibles/magnet_area.gd" id="2_cvw10"]

[sub_resource type="GDScript" id="GDScript_6qpsl"]
script/source = "class_name Coin
extends Area3D

const ROTATION_SPEED = 2

@export var coin_manager : CoinManager = null

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	pass # Replace with function body.

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	rotate_y(deg_to_rad(ROTATION_SPEED))


func _on_body_entered(body: Node3D) -> void:
	manage_coin_resources()
	disable_further_interactions()
	$AnimationPlayer.play(\"bounce\")
	SoundManager.play_coin_collect()

func disable_further_interactions() -> void:
	set_collision_layer_value(Global.Layers.ITEM, false)
	set_collision_mask_value(Global.Layers.PLAYER, false)
	
func manage_coin_resources() -> void:
	coin_manager.handle_coin_collect()
	
func _on_animation_player_animation_finished(anim_name: StringName) -> void:
	queue_free()
"

[sub_resource type="CylinderShape3D" id="CylinderShape3D_6qpsl"]
height = 0.1
radius = 0.2

[sub_resource type="Animation" id="Animation_0t63x"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("MeshInstance3D:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(9.1343285e-17, 2.0896909e-09, 0)]
}

[sub_resource type="Animation" id="Animation_d5gmh"]
resource_name = "bounce"
length = 0.25
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("MeshInstance3D:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.25),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector3(9.1343285e-17, 2.0896909e-09, 0), Vector3(0, 1.2, 0), Vector3(0, 0.8, 0)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_v7riw"]
_data = {
&"RESET": SubResource("Animation_0t63x"),
&"bounce": SubResource("Animation_d5gmh")
}

[sub_resource type="SphereShape3D" id="SphereShape3D_cvw10"]

[node name="Coin" type="Area3D" groups=["coin"]]
collision_layer = 4
script = SubResource("GDScript_6qpsl")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
transform = Transform3D(0, 0.25510654, 8.945805e-09, 8.792199e-09, -1.115106e-08, 0.20465615, 0.20114207, 8.881784e-16, -8.945805e-09, 9.1343285e-17, 2.0896909e-09, 0)
mesh = ExtResource("1_d5gmh")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(-4.371139e-08, 1, 0, -1, -4.371139e-08, 0, 0, 0, 1, 0, 0, 0)
shape = SubResource("CylinderShape3D_6qpsl")

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_v7riw")
}

[node name="MagnetArea" type="Area3D" parent="." node_paths=PackedStringArray("coin")]
collision_layer = 0
script = ExtResource("2_cvw10")
coin = NodePath("..")

[node name="CollisionShape3D" type="CollisionShape3D" parent="MagnetArea"]
transform = Transform3D(2.5, 0, 0, 0, 0.5, 0, 0, 0, 2.5, 0, 0, 0)
shape = SubResource("SphereShape3D_cvw10")

[connection signal="body_entered" from="." to="." method="_on_body_entered"]
[connection signal="animation_finished" from="AnimationPlayer" to="." method="_on_animation_player_animation_finished"]
[connection signal="body_entered" from="MagnetArea" to="MagnetArea" method="_on_body_entered"]
